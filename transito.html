<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Simulador de Tránsito Exoplanetario</title>
  <style>
    :root{--bg:#000;--fg:#fff;--accent:#0af}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:Arial,Helvetica,sans-serif;display:flex;flex-direction:column;align-items:center}
    h1{margin:20px 0;text-align:center}
    #wrapper{display:flex;flex-wrap:wrap;gap:24px;justify-content:center;max-width:1200px;width:100%}
    canvas{background:#111;border:1px solid #555;border-radius:8px}
    #controls{width:100%;max-width:900px;margin-top:24px}
    .control{display:flex;flex-direction:column;align-items:center;margin-bottom:14px}
    input[type=range]{width:90%}
    label span{color:var(--accent);min-width:5ch;display:inline-block}
    /* --- Estilo universal para sliders visible en Safari, Mac, Windows --- */
    input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    width: 90%;
    height: 12px;
    background: #8b8b8b;
    border-radius: 6px;
    outline: none;
    margin-top: 10px;
    }

    input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    background: #00ffff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 2px #000;
    }

    input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background: #00ffff;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    }

  </style>
</head>
<body>
  <h1>Simulador de Tránsito Exoplanetario</h1>
  <div id="wrapper">
    <canvas id="orbitCanvas" width="450" height="450"></canvas>
    <canvas id="curveCanvas" width="500" height="450"></canvas>
  </div>
  <div id="controls">
    <div class="control">
      <label for="xSlider">Posición horizontal del planeta (R*): <span id="xLabel">-2.00</span></label>
      <input type="range" id="xSlider" min="-3" max="3" step="0.05" value="-2" />
    </div>
    <div class="control">
      <label for="rSlider">Radio del planeta (R*): <span id="rLabel">0.10</span></label>
      <input type="range" id="rSlider" min="0.05" max="1.0" step="0.01" value="0.10" />
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const curveCanvas = document.getElementById("curve");
  const curveCtx = curveCanvas.getContext("2d");

  const rSlider = document.getElementById("radiusSlider");
  const dSlider = document.getElementById("distanceSlider");
  const rLabel = document.getElementById("radiusLabel");
  const dLabel = document.getElementById("distanceLabel");

  const R = 100; // radio de la estrella
  const u = 0.6; // coeficiente de oscurecimiento de limbo

  function drawScene(planetX) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // dibujar estrella con oscurecimiento de limbo
    let grad = ctx.createRadialGradient(R, R, 0, R, R, R);
    grad.addColorStop(0, "white");
    grad.addColorStop(1, "#aaaaaa");
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(R, R, R, 0, 2 * Math.PI);
    ctx.fill();

    // planeta
    const r = parseFloat(rSlider.value);
    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(planetX, R, r, 0, 2 * Math.PI);
    ctx.fill();
  }

  function computeFlux(planetX, r) {
    const size = 2 * R;
    let total = 0;
    let blocked = 0;

    for (let y = 0; y < size; y++) {
      for (let x = 0; x < size; x++) {
        const dx = x - R;
        const dy = y - R;
        const dist = Math.sqrt(dx*dx + dy*dy);

        if (dist <= R) {
          const mu = Math.sqrt(1 - (dist*dist)/(R*R));
          const intensity = 1 - u * (1 - mu);
          total += intensity;

          const dpx = x - planetX;
          const dpy = y - R;
          if (dpx*dpx + dpy*dpy <= r*r) {
            blocked += intensity;
          }
        }
      }
    }

    return 1 - blocked / total;
  }

  function drawCurve() {
    curveCtx.clearRect(0, 0, curveCanvas.width, curveCanvas.height);
    const r = parseFloat(rSlider.value);
    const d = parseFloat(dSlider.value);
    const points = [];

    for (let i = 0; i < 200; i++) {
      const x = R + (i - 100) * d;
      const flux = computeFlux(x, r);
      points.push(flux);
    }

    curveCtx.beginPath();
    curveCtx.moveTo(0, (1 - points[0]) * 200);
    for (let i = 1; i < points.length; i++) {
      curveCtx.lineTo(i, (1 - points[i]) * 200);
    }
    curveCtx.strokeStyle = "cyan";
    curveCtx.lineWidth = 2;
    curveCtx.stroke();
  }

  function update() {
    const r = parseFloat(rSlider.value);
    const d = parseFloat(dSlider.value);
    const planetX = R + (100 - 100) * d;

    rLabel.textContent = r.toFixed(1);
    dLabel.textContent = d.toFixed(1);

    drawScene(R);
    drawCurve();
  }

  rSlider.oninput = update;
  dSlider.oninput = update;

  update();
  </script>
</body>
</html>
